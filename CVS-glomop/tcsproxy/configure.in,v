head	1.65;
access;
symbols
	Yatin-final:1.61.2.2
	Yatin:1.61.0.2
	pre-yatin-merge:1.61
	transend-beta2:1.50
	fox-dev:1.50
	transend-ng:1.36
	transend-beta-latest:1.36
	Aggregators:1.36
	NoAggregators:1.35
	iang:1.32.0.2
	transend-beta:1.30.0.2
	SOSP:1.27
	merged_preintegrate:1.18
	heisenbug:1.18
	PRE_INTEGRATION:1.18;
locks; strict;
comment	@# @;


1.65
date	98.06.09.03.31.28;	author fox;	state Exp;
branches;
next	1.64;

1.64
date	98.06.08.20.11.23;	author fox;	state Exp;
branches;
next	1.63;

1.63
date	98.01.16.22.15.44;	author yatin;	state Exp;
branches;
next	1.62;

1.62
date	97.11.21.23.17.11;	author tkimball;	state Exp;
branches;
next	1.61;

1.61
date	97.11.12.23.43.14;	author yatin;	state Exp;
branches
	1.61.2.1;
next	1.60;

1.60
date	97.11.05.21.59.49;	author iang;	state Exp;
branches;
next	1.59;

1.59
date	97.10.26.19.24.02;	author tkimball;	state Exp;
branches;
next	1.58;

1.58
date	97.10.26.06.44.14;	author gribble;	state Exp;
branches;
next	1.57;

1.57
date	97.10.05.19.26.48;	author iang;	state Exp;
branches;
next	1.56;

1.56
date	97.09.24.02.05.23;	author fox;	state Exp;
branches;
next	1.55;

1.55
date	97.09.19.01.28.34;	author yatin;	state Exp;
branches;
next	1.54;

1.54
date	97.09.19.00.38.51;	author yatin;	state Exp;
branches;
next	1.53;

1.53
date	97.09.18.22.45.12;	author yatin;	state Exp;
branches;
next	1.52;

1.52
date	97.09.18.22.32.32;	author fox;	state Exp;
branches;
next	1.51;

1.51
date	97.09.06.01.08.46;	author fox;	state Exp;
branches;
next	1.50;

1.50
date	97.07.26.00.29.37;	author fox;	state Exp;
branches;
next	1.49;

1.49
date	97.07.25.01.06.27;	author fox;	state Exp;
branches;
next	1.48;

1.48
date	97.07.24.18.49.57;	author fox;	state Exp;
branches;
next	1.47;

1.47
date	97.07.16.08.15.26;	author fox;	state Exp;
branches;
next	1.46;

1.46
date	97.07.15.02.43.00;	author fox;	state Exp;
branches;
next	1.45;

1.45
date	97.07.11.22.15.00;	author fox;	state Exp;
branches;
next	1.44;

1.44
date	97.07.09.02.13.29;	author fox;	state Exp;
branches;
next	1.43;

1.43
date	97.07.08.02.05.06;	author fox;	state Exp;
branches;
next	1.42;

1.42
date	97.07.03.17.47.23;	author fox;	state Exp;
branches;
next	1.41;

1.41
date	97.06.23.04.05.55;	author fox;	state Exp;
branches;
next	1.40;

1.40
date	97.06.12.23.51.55;	author fox;	state Exp;
branches;
next	1.39;

1.39
date	97.06.12.21.19.54;	author fox;	state Exp;
branches;
next	1.38;

1.38
date	97.06.12.18.31.28;	author fox;	state Exp;
branches;
next	1.37;

1.37
date	97.06.06.00.07.35;	author fox;	state Exp;
branches;
next	1.36;

1.36
date	97.05.21.19.40.58;	author fox;	state Exp;
branches;
next	1.35;

1.35
date	97.05.14.04.27.22;	author gribble;	state Exp;
branches;
next	1.34;

1.34
date	97.05.14.03.09.54;	author gribble;	state Exp;
branches;
next	1.33;

1.33
date	97.05.11.10.16.43;	author fox;	state Exp;
branches;
next	1.32;

1.32
date	97.04.28.18.20.16;	author fox;	state Exp;
branches
	1.32.2.1;
next	1.31;

1.31
date	97.04.28.18.01.58;	author gribble;	state Exp;
branches;
next	1.30;

1.30
date	97.04.24.21.25.04;	author gribble;	state Exp;
branches
	1.30.2.1;
next	1.29;

1.29
date	97.04.21.22.36.55;	author aspolito;	state Exp;
branches;
next	1.28;

1.28
date	97.04.17.21.44.45;	author aspolito;	state Exp;
branches;
next	1.27;

1.27
date	97.02.20.18.56.55;	author gribble;	state Exp;
branches;
next	1.26;

1.26
date	97.02.14.02.46.57;	author yatin;	state Exp;
branches;
next	1.25;

1.25
date	97.02.10.21.35.46;	author gribble;	state Exp;
branches;
next	1.24;

1.24
date	97.02.02.04.16.15;	author gribble;	state Exp;
branches;
next	1.23;

1.23
date	97.01.26.02.08.23;	author gribble;	state Exp;
branches;
next	1.22;

1.22
date	97.01.24.01.23.34;	author gribble;	state Exp;
branches;
next	1.21;

1.21
date	97.01.23.23.10.33;	author gribble;	state Exp;
branches;
next	1.20;

1.20
date	97.01.08.03.39.09;	author fox;	state Exp;
branches;
next	1.19;

1.19
date	97.01.06.05.43.23;	author fox;	state Exp;
branches;
next	1.18;

1.18
date	96.12.12.03.12.22;	author gribble;	state Exp;
branches;
next	1.17;

1.17
date	96.12.10.23.04.25;	author gribble;	state Exp;
branches;
next	1.16;

1.16
date	96.12.10.22.36.46;	author fox;	state Exp;
branches;
next	1.15;

1.15
date	96.12.08.23.13.25;	author fox;	state Exp;
branches;
next	1.14;

1.14
date	96.12.03.11.01.04;	author gribble;	state Exp;
branches;
next	1.13;

1.13
date	96.12.01.00.10.16;	author gribble;	state Exp;
branches;
next	1.12;

1.12
date	96.11.24.08.13.17;	author yatin;	state Exp;
branches;
next	1.11;

1.11
date	96.11.23.00.51.14;	author yatin;	state Exp;
branches;
next	1.10;

1.10
date	96.11.22.23.07.45;	author fox;	state Exp;
branches;
next	1.9;

1.9
date	96.11.22.21.42.00;	author fox;	state Exp;
branches;
next	1.8;

1.8
date	96.11.21.01.59.55;	author gribble;	state Exp;
branches;
next	1.7;

1.7
date	96.11.08.01.50.34;	author fox;	state Exp;
branches;
next	1.6;

1.6
date	96.11.06.07.51.13;	author fox;	state Exp;
branches;
next	1.5;

1.5
date	96.10.28.20.40.33;	author fox;	state Exp;
branches;
next	1.4;

1.4
date	96.10.27.22.04.50;	author fox;	state Exp;
branches;
next	1.3;

1.3
date	96.10.26.00.57.19;	author fox;	state Exp;
branches;
next	1.2;

1.2
date	96.10.12.02.57.17;	author fox;	state Exp;
branches;
next	1.1;

1.1
date	96.10.09.01.02.26;	author fox;	state Exp;
branches;
next	;

1.30.2.1
date	97.04.28.18.02.18;	author gribble;	state Exp;
branches;
next	1.30.2.2;

1.30.2.2
date	97.04.28.18.27.09;	author gribble;	state Exp;
branches;
next	;

1.32.2.1
date	97.05.08.23.28.58;	author iang;	state Exp;
branches;
next	;

1.61.2.1
date	97.11.25.01.25.06;	author yatin;	state Exp;
branches;
next	1.61.2.2;

1.61.2.2
date	97.12.02.21.04.33;	author iang;	state Exp;
branches;
next	;


desc
@@


1.65
log
@changed configure.in to correctly set javaincdir and javalibdir vars;
edited java stub makefiles to get right linking order on cmd line
@
text
@AC_INIT(README)

AC_CANONICAL_SYSTEM

AC_ARG_WITH(defaultoptions, -with-defaultoptions[=filename]	use <filename> as default options file, , with_defaultoptions=".configure")

if test "$with_defaultoptions" = "yes" ; then
	with_defaultoptions=".configure"
elif test "$with_defaultoptions" = "no" ; then
	with_defaultoptions=""
fi

if test -n "$with_defaultoptions" ; then
	if test -f "$with_defaultoptions" ; then
		read arglist < $with_defaultoptions
	
		if test -n "$arglist" ; then 
			arguments="$0 $arglist $* --without-defaultoptions"
			echo "Restarting: $arguments" 
			exec $arguments
		fi
	else
		if test "$with_defaultoptions" = ".configure" ; then
			echo No .configure file found in current directory
			echo Continuing with default options...
		else
			echo Cannot find file $with_defaultoptions
			echo Aborting configure...
			exit 1
		fi
	fi
fi


AC_ARG_ENABLE(mkdep, -enable-mkdep/-disable-mkdep      enable/disable invocation of \"make depend\", , enable_mkdep="yes")


AC_CONFIG_HEADER(config_tr.h)

AC_ARG_WITH(netpbm,
  --with-netpbm=DIR      Look for NetPBM lib/ and include/ in DIR,
    CPPFLAGS="$CPPFLAGS -I${withval}/include"
    LDFLAGS="$LDFLAGS -L${withval}/lib",
    CPPFLAGS="$CPPFLAGS -I/usr/sww/include"
    LDFLAGS="$LDFLAGS -L/usr/sww/lib"
)
AC_ARG_WITH(jpeg,
  --with-jpeg=DIR      Look for libjpeg lib/ and include/ in DIR,
    CPPFLAGS="$CPPFLAGS -I${withval}/include"
    LDFLAGS="$LDFLAGS -L${withval}/lib",
    CPPFLAGS="$CPPFLAGS -I/usr/sww/include -I/usr/sww/share/include/libjpeg-6a"
    LDFLAGS="$LDFLAGS -L/usr/sww/lib"
)
AC_ARG_WITH(gdbm,
  --with-gdbm=DIR      Look for libgdbm lib/ and include/ in DIR,
    CPPFLAGS="$CPPFLAGS -I${withval}/include"
    LDFLAGS="$LDFLAGS -L${withval}/lib",
    CPPFLAGS="$CPPFLAGS -I/usr/sww/include -I/usr/sww/share/include"
    LDFLAGS="$LDFLAGS -L/usr/sww/lib"
)
AC_ARG_WITH(perlinc,
  --with-perlinc=DIR   Look for Perl LWP and MD5 packages in DIR,
  PERLINC="-I${withval}",
  PERLINC=""
)
AC_ARG_WITH(tcl,
  --with-tcl=DIR          Look for lib/libtcl.a and include/tcl.h in DIR,
  TCLINCLUDE="-I${withval}/include"
  TCLLIBS="-L${withval}/lib",
  TCLINCLUDE="-I/usr/sww/include"
  TCLLIBS="-L/usr/sww/lib"
)
AC_ARG_WITH(tclinclude,
  --with-tclinclude=DIR   Look for tcl.h and tk.h directly in DIR,
  TCLINCLUDE="-I${withval}"
)
AC_ARG_WITH(tclver,
  --with-tclver=VERSION   Append VERSION to the tcl library and binary files,
  TCL_VERSION="${withval}",
  TCL_VERSION=""
)
AC_ARG_WITH(tkver,
  --with-tkver=VERSION   Append VERSION to the tk library and binary files,
  TK_VERSION="${withval}",
  TK_VERSION="${with_tclver}"
)
AC_ARG_ENABLE(tcl-stub,
  --enable-tcl-stub         Enable compilation of tcl_stub, 
  , enable_tcl_stub="no"
)
AC_ARG_ENABLE(java,
  --enable-java             Enable compilation of java_stub,
  , enable_java_stub="no"
)
AC_ARG_WITH(java,
  --with-java=DIR         Look for Java include/jni.h and lib/libjava.a in DIR,
  JAVAINCDIR="${withval}/include"
  JAVALIBDIR="${withval}/lib"
)
AC_ARG_WITH(javainc,
  --with-javainclude=DIR  Look for jni.h directly in DIR,
  JAVAINCDIR="${withval}"
)
AC_ARG_WITH(javalib,
  --with-javalib=DIR      Look for libjava.a directly in DIR,
  JAVALIBDIR="${withval}"
)
AC_SUBST(JAVAINCDIR)
AC_SUBST(JAVALIBDIR)
AC_SUBST(TCLINCLUDE)
AC_SUBST(TCLLIBS)
AC_SUBST(TCL_VERSION)
AC_SUBST(TK_VERSION)
AC_SUBST(PURIFY)

CFLAGS="-g  -D_REENTRANT"
AC_PROG_INSTALL
AC_PROG_CC
if test "$ac_cv_prog_gcc" = yes; then
      CFLAGS="-Wall -pedantic $CFLAGS"
fi
AC_CHECK_PROGS(CXX, g++ c++)
AC_PROG_CXX
AC_PROG_RANLIB
AC_PROG_LEX

AC_CHECK_PROGS(MAKEEX,gmake make)

AC_ARG_WITH(perl,
  --with-perl=<pathname>   Use <pathname> as the perl binary,
  PERL="${withval}",
  PERL=""
)
if test -z "$PERL" ; then
	AC_PATH_PROGS(PERL,perl perl5)
fi

AC_ARG_WITH(wish,
  --with-wish=<pathname>   Use <pathname> as the wish binary,
  WISH="${withval}",
  WISH=""
)
if test -z "$WISH" ; then
	AC_PATH_PROGS(WISH,wish wishx)
fi

if test "$enable_tcl_stub" = "yes" ; then
	TCL_STUB_TARGET="tcl_stub"
	echo Enabling compilation of tcl_stub
else
	TCL_STUB_TARGET=""
	echo Disabling compilation of tcl_stub
fi
AC_SUBST(TCL_STUB_TARGET)

AC_CHECK_SIZEOF(int)
AC_CHECK_SIZEOF(long)

AC_REPLACE_FUNCS(strcasecmp)
AC_CHECK_FUNCS(snprintf)
AC_REPLACE_FUNCS(snprintf)

AC_CHECK_LIB(pthread,pthread_create,LIBTHREAD="-lpthread",AC_CHECK_LIB(pthreads,pthread_create,LIBTHREAD="-lpthreads",AC_MSG_ERROR(You need either -lpthread or -lpthreads to build this system.)))

AC_ARG_WITH(staticpthread, --with-staticpthread=<lib-path>      use <lib-path> as the pthreads library, LIBTHREAD=$with_staticpthread, )
AC_SUBST(LIBTHREAD)

AC_CHECK_LIB(perl,perl, LIBPERL="-lperl", LIBPERL="-lperl")

AC_ARG_WITH(staticperl, --with-staticperl=<lib-path>      use <lib-path> as the perl library, LIBPERL=$with_staticperl, )
AC_SUBST(LIBPERL)

if test "$enable_java_stub" = "yes" ; then
	JAVA_STUB_TARGET="java_stub"
	echo Enabling compilation of java_stub
else
	JAVA_STUB_TARGET=""
	echo Disabling compilation of java_stub
fi


AC_CHECK_LIB(socket,socket,LIBS="$LIBS -lsocket -lnsl")

dnl Define -DSYSV for pbmplus.h if this system doesn't have strings.h.

AC_CHECK_HEADER(strings.h,,AC_DEFINE(SYSV))

dnl Check for "struct timespec {"
AC_CHECK_HEADERS(time.h sys/time.h sys/timers.h)

dnl Check for pthreads
AC_CHECK_HEADERS(thread.h pthread.h)

dnl Check for MIT pthreads.  If present, we have to define a
dnl preprocessor symbol so the correct files get included.
AC_CHECK_HEADERS(pthread/mit/pthread_attr.h,CPPFLAGS="$CPPFLAGS -D_MIT_POSIX_THREADS")

dnl Check for NetPBM headers and libraries

AC_CHECK_HEADER(ppm.h,,AC_MSG_ERROR(Cannot find NetPBM header files.  See the README for help.))
AC_CHECK_LIB(pnm,pnm_init,DUMMY=,AC_MSG_ERROR(Cannot find NetPBM libraries.  See the README for help.),-lppm -lpgm -lpbm -lm)
dnl Check for libjpeg headers and libraries

AC_CHECK_HEADER(jpeglib.h,,AC_MSG_ERROR(Cannot find libjpeg header files.  See the README for help.))
AC_CHECK_LIB(jpeg,jpeg_abort,DUMMY=,AC_MSG_ERROR(Cannot find libjpeg libraries.  See the README for help.),)
dnl Check for libgdbm headers and libraries

AC_CHECK_HEADER(gdbm.h,,AC_MSG_ERROR(Cannot find libgdbm header files.  See the README for help.))
AC_CHECK_LIB(gdbm,gdbm_fetch,DUMMY=,AC_MSG_ERROR(Cannot find libgdbm libraries.  See the README for help.),)

dnl Check for libintl (and libdl) - solaris-specific lossage.

AC_CHECK_LIB(intl,dgettext,LIBS="$LIBS -lintl")
AC_CHECK_LIB(dl,dlopen,LIBS="$LIBS -ldl",AC_MSG_WARN("no libdl"))

dnl AC_CHECK_LIB(tcl$TCL_VERSION,Tcl_CreateCommand,LIBTCL="-ltcl$TCL_VERSION",AC_CHECK_LIB(tcl7.6,Tcl_CreateCommand,LIBTCL="-ltcl7.6",AC_MSG_ERROR(Cannot find libtcl.a or libtcl.so - please specify --with-tcl.),-lm),-lm)
dnl AC_SUBST(LIBTCL)

dnl Solaris linker takes "-Rpath" to include runtime libraries and
dnl doesn't recognize  -rdynamic.  GNU linker takes some other weirdness
dnl and DOES recognize -rdynamic.

case "$target_os" in
solaris*)
        LDRUNPATHARGS="-R"
        ;;
*)
        LDRUNPATHARGS="-rdynamic -Wl,-rpath -Wl,"
        ;;
esac

INCLUDEPATH=".. ../frontend/include ../client_lib/include ../ptm/include ../monitor/include ../playback/include ../gui"


AC_HEADER_STDC
AC_SUBST(JAVA_STUB_TARGET)
AC_SUBST(INSTALL)
AC_SUBST(CC)
AC_SUBST(CXX)
AC_SUBST(INCLUDEPATH)
AC_SUBST(PERL)
AC_SUBST(WISH)
AC_SUBST(top_srcdir)
AC_SUBST(enable_mkdep)
AC_SUBST(LDRUNPATHARGS)
AC_OUTPUT(Makefile 
          frontend/Makefile 
          client_lib/Makefile 
          tcp_redirect/Makefile
          html_munger/Makefile
          gif_munger/Makefile
          jpg_munger/Makefile
          giftojpg_munger/Makefile
          2bit_munger/Makefile
          text2doc/Makefile
          Tbmp_munger/Makefile
          playback/Makefile
          playback/src/cachesim/Makefile
	  ptm/Makefile
          gui/Makefile
	  perl_stub/Makefile
          java_stub/Makefile
	  tcl_stub/Makefile
          xs/Makefile.PL
          harness/Makefile
)


MAKE_DEPEND_DIRS="ptm"

cat >> Makefile <<EOF
depend:
EOF


for DIR in $MAKE_DEPEND_DIRS; do 
	if test ! -f $DIR/Makefile.depend ; then
		# create an empty Makefile.depend directory
		cat > $DIR/Makefile.depend <<EOF
EOF
	fi

	cat >> Makefile <<EOF
	cd $DIR; \$(MAKE) depend
EOF
done

if test "$enable_mkdep" = "yes" ; then
	$MAKEEX depend
fi
@


1.64
log
@added stuff to configure.in to support java stub compilation (include
and lib paths for java runtime and VM); to toplevel Makefile to support
conditional compilation of java stub (if --enable-java is given to
configure); added java_stub.c and Makefile.in (based on their
counterparts from perl_stub).  The java stub will be designed so that
Servlets can be loaded directly into it, ie it will expect to load a
classfile that implements a subclass of Servlet, and then have
DistillerInit() and DistillerMain() call the servlet's init and main
functions respectively.
@
text
@d98 1
a98 1
  JAVALIBDIR="-L${withval}/lib"
d100 1
a100 1
AC_ARG_WITH(javainclude,
d106 1
a106 1
  JAVALIBDIR="-L${withval}"
a155 9
if test "$enable_java_stub" = "yes" ; then
	JAVA_STUB_TARGET="java_stub"
	echo Enabling compilation of java_stub
else
	JAVA_STUB_TARGET=""
	echo Disabling compilation of java_stub
fi
AC_SUBST(JAVA_STUB_TARGET)

d173 7
d236 1
@


1.63
log
@- new wingman frontend
- new wingman aggregators mechanism
- DistillAsync

(merged from branch Yatin-final)
@
text
@d91 19
a109 1

d156 8
d263 1
@


1.62
log
@Commiting changes to configure.in and perl_stub/Makefile.in.
Changes: Added option to compile --with-staticperl


Tim
@
text
@d192 2
a193 2
AC_CHECK_LIB(tcl,Tcl_CreateCommand,LIBTCL="-ltcl",AC_CHECK_LIB(tcl7.6,Tcl_CreateCommand,LIBTCL="-ltcl7.6",AC_MSG_ERROR(Cannot find libtcl.a or libtcl.so - please specify --with-tcl.),-lm),-lm)
AC_SUBST(LIBTCL)
@


1.61
log
@moved from mash_stub to tcl_stub
@
text
@d147 1
d150 8
@


1.61.2.1
log
@- removed -ltcl check in configure.in. It was causing problems with tcl8.0 and
  wasn't being used anyway.
- frontend returns a sane error when transend/myurl/dispatch fails
- added more API functions to tcl_stub
- wingman gm_options aggregators work
- fixed bug in DistillerType::CanSatisfy
- removed debugging printf's from libdist
@
text
@d183 2
a184 2
#AC_CHECK_LIB(tcl,Tcl_CreateCommand,LIBTCL="-ltcl$TCL_VERSION",AC_CHECK_LIB(tcl7.6,Tcl_CreateCommand,LIBTCL="-ltcl7.6",AC_MSG_ERROR(Cannot find libtcl.a or libtcl.so - please specify --with-tcl.),-lm),-lm)
#AC_SUBST(LIBTCL)
@


1.61.2.2
log
@.
@
text
@d183 2
a184 2
dnl AC_CHECK_LIB(tcl$TCL_VERSION,Tcl_CreateCommand,LIBTCL="-ltcl$TCL_VERSION",AC_CHECK_LIB(tcl7.6,Tcl_CreateCommand,LIBTCL="-ltcl7.6",AC_MSG_ERROR(Cannot find libtcl.a or libtcl.so - please specify --with-tcl.),-lm),-lm)
dnl AC_SUBST(LIBTCL)
@


1.60
log
@Added text-to-doc conversion
@
text
@a68 1
  LDFLAGS="$LDFLAGS -L${withval}/lib"
a70 1
  LDFLAGS="$LDFLAGS -L/usr/sww/lib"
d77 13
a89 5

AC_ARG_WITH(mash,
  --with-mash=DIR         Look for mash source in DIR,
  MASHDIR=${withval},
  MASHDIR=""
d94 2
a96 1
AC_SUBST(MASHDIR)
a108 2
AC_PATH_PROGS(PERL,perl perl5)
AC_PATH_PROGS(WISH,wish wishx)
d111 21
a131 3
if test -z "$MASHDIR" ; then
	MASH_STUB_TARGET=""
	MAKE_LIBSMASH_O="echo Cannot find source for mash; Skipping compilation of libsmash.o"
d133 2
a134 19
	MASH_STUB_TARGET="mash_stub"
	if test -f "$MASHDIR/../Makefile" ; then
		echo Found a possible candidate Makefile for mash
		CURDIR=`pwd`
		cd $MASHDIR/..
		$MAKEEX -n libsmash.o
		STATUS=$?
		cd $CURDIR
		if test "$STATUS" != 0 ; then
			echo No target libsmash.o in $MASHDIR/../Makefile
			MAKE_LIBSMASH_O="echo Cannot find source for mash; Skipping compilation of libsmash.o"
		else
			echo Found target libsmash.o in $MASHDIR/../Makefile
			MAKE_LIBSMASH_O="cd $MASHDIR/..; \$(MAKE) libsmash.o"
		fi
	else
		echo Cannot find mash Makefile in $MASHDIR/..
		MAKE_LIBSMASH_O="echo Cannot find source for mash; Skipping compilation of libsmash.o"
	fi
d136 1
a136 2
AC_SUBST(MASH_STUB_TARGET)
AC_SUBST(MAKE_LIBSMASH_O)
d147 1
d228 1
a228 1
	  mash_stub/Makefile
@


1.59
log
@Trying to commit my gm_options file! Please work!
@
text
@d215 1
@


1.58
log
@Fixed up config_tr.h.in and configure.in so that the snprintf trick works on both solaris and linux.
@
text
@d223 1
@


1.57
log
@2-bit image distillation is now faster and better quality
@
text
@d138 1
@


1.56
log
@calling other distillers now works from perl - still need to check for
mem leaks, weird cases, etc.  added stuff in configure.in to set the
right arguments for runtime lib paths, for both solaris ld and gnu ld.
@
text
@d213 1
@


1.55
log
@bug fixes
@
text
@d3 1
d179 13
d204 1
@


1.54
log
@bug fixes
@
text
@d209 20
a228 1
if test "$enable_mkdep"="yes" ; then
@


1.53
log
@added mash_stub
mash_stub is compiled only if --with-mashdir flag is set
added a --enable/disable-mkdep flag to configure
configure can read default arguments from a special file .configure in
the toplevel tcsproxy directory
@
text
@d210 1
a210 1
	make depend
@


1.52
log
@*** empty log message ***
@
text
@d3 34
d78 7
a84 1
  
d88 1
d105 28
d180 1
d189 1
d204 1
d207 5
@


1.51
log
@Removed compile time dependencies: proxy.home and proxy.perlmod are now
config file options, so perl_stub doesn't need to know them at compile
time (it constructs the -I path at runtime from the options file
values).  Options_Find() has been exported to Perl (in
clib.xs) and is emulated for the harness (in clib.pm).  pilotFonts
directory was added for wingman distiller.  PilotFonts module now has an
explicit init_fonts() call that supplies the dir name containing the
pilot fonts.  Added documentation to clib.pm, TACCutils.pm,
PilotFonts.pm and SimpleFont.pm.  removed all path-related dependencies
in existing distillers and unpack_tstr.pl, and added font path error
checking to layout.tcl
@
text
@d127 1
@


1.50
log
@makefile fixes to have lib/ subdir now work on both.  anonymization added to frontend.  still a lurking stack-stomping bug in httpsupport.c
@
text
@a60 11

dnl Check for LWP and related Perl libraries

echo Checking for Perl libraries...
if $PERL $PERLINC -e 'use LWP' ; then
echo Using "$PERLINC" as Perl include path
else
AC_MSG_ERROR(LWP.pm and related Perl packages not found. See  README for help.)
fi
AC_SUBST(PERLINC)

@


1.49
log
@temporary commit so anthony can make; still tracking memory bug interaction frontend/clientlib
@
text
@d65 3
a67 1
if [! { $PERL $PERLINC -e 'use LWP' }] then
a68 2
else
echo Using "$PERLINC" as Perl include path
@


1.48
log
@debugging/monitoring function interface in frontend cleaned up.  change to xs/Makefile.PL.in to avoid spurious double initialization of stuff in libdist.a when clib.so was dynamically loaded.
@
text
@d26 5
a30 1

d40 5
d59 1
d61 11
@


1.47
log
@makefile changes to get everything to compile with 2 different versions of pthreads, and with tcl/tk that does not already link the gcc library.
@
text
@d58 1
@


1.46
log
@makefile changes to link pthreads only at end, which was causing severe bad behaviors under linux since different people were calling different signal()s.  SIGHUP is now used instead of SIGUSR1 to signal components to reinitialize themselves, and SIGTERM is used to kill them gracefully.  Layout stuff for Pilot works but is still inelegant.
@
text
@d68 1
a68 1
AC_CHECK_HEADERS(time.h sys/time.h sys/timers.h thread.h)
d71 5
a75 1
AC_CHECK_HEADERS(pthread.h pthread/mit/pthread_attr.h)
@


1.45
log
@*** empty log message ***
@
text
@d40 1
a40 1
CFLAGS="-g -D_MIT_POSIX_THREADS -D_REENTRANT"
d59 2
a60 1
AC_CHECK_LIB(pthread,pthread_create,,AC_CHECK_LIB(pthreads,pthread_create))
d72 1
d91 2
a92 1
AC_CHECK_LIB(tcl,Tcl_CreateCommand,LIBS="$LIBS -ltcl",AC_CHECK_LIB(tcl7.6,Tcl_CreateCommand,LIBS="$LIBS -ltcl7.6",AC_MSG_ERROR(Cannot find libtcl.a or libtcl.so - please specify --with-tcl.),-lm),-lm)
a106 1
          client_lib/src/Makefile
@


1.44
log
@*** empty log message ***
@
text
@d30 1
d33 1
d89 1
a89 1
AC_CHECK_LIB(tcl,Tcl_CreateCommand,LIBS="$LIBS -ltcl",AC_MSG_ERROR(Cannot find libtcl.a o libtcl.so - please specify --with-tcl.),-lm)
@


1.43
log
@uses perl Config module to get perl installation paths and make a perl_stub and perl_dir/harness that configure themselves correctly for this installation
@
text
@a112 1
          perl_dir/harness
@


1.42
log
@*** empty log message ***
@
text
@a26 10
AC_ARG_WITH(perl,
  --with-perl=DIR      Look for both perl.h and libperl.a in DIR,
    CPPFLAGS="$CPPFLAGS -I${withval}"
    LDFLAGS="$LDFLAGS -L${withval}"
    PERL_DYNALOADER="${withval}/../auto/DynaLoader/DynaLoader.a",
    CPPFLAGS="$CPPFLAGS -I/usr/sww/lib/perl5/CORE"
    LDFLAGS="$LDFLAGS -L/usr/sww/lib/perl5/CORE"
    PERL_DYNALOADER="/usr/sww/lib/perl5/auto/DynaLoader/DynaLoader.a"
)

a59 7
dnl Check for libperl headers and libraries

AC_CHECK_HEADER(perl.h,,AC_MSG_ERROR(Cannot find perl header files.  See the README for help.))
AC_CHECK_LIB(perl,croak,DUMMY=,AC_CHECK_LIB(perl,Perl_croak,DUMMY=,AC_MSG_ERROR(Cannot find libperl libraries.  See the README for help.),-lm $LIBS),-lm $LIBS)

dnl Check for libintl (and libdl) - solaris-specific lossage.

d82 2
a95 1
AC_SUBST(PERL_DYNALOADER)
d113 1
@


1.41
log
@*** empty log message ***
@
text
@d13 1
a13 1
  --with-libjpeg=DIR      Look for libjpeg lib/ and include/ in DIR,
d20 1
a20 1
  --with-libgdbm=DIR      Look for libgdbm lib/ and include/ in DIR,
d28 1
a28 1
  --with-libperl=DIR      Look for both perl.h and libperl.a in DIR,
@


1.40
log
@fixed typo for AC_PATH_PROGS invocation in configure.in
@
text
@d12 1
a12 1
AC_ARG_WITH(libjpeg,
d19 1
a19 1
AC_ARG_WITH(libgdbm,
d27 1
a27 1
AC_ARG_WITH(libperl,
d37 9
d102 1
a102 2
builtin(include, configure.in.tcl)
builtin(include, configure.in.tk)
@


1.39
log
@needed to subst WISH variable
@
text
@d49 3
a51 3
AC_PATH_PROGS(PERL,perl,perl5,:)
AC_PATH_PROGS(WISH,wish,wishx,:)
AC_CHECK_PROGS(MAKEEX,gmake,make)
@


1.38
log
@various changes to makefiles to support auto-installation into sbin and bin directories.  perl HTML distiller no longer inserts UI in pages with frames.  PREFS_URL and similar strings are now static char* instead of #defines, but still need them to be initialized in PTM stub so distillers can get at them.  "run" targets are better now, they run stuff from the sbin and bin directories.
@
text
@d105 1
@


1.37
log
@Many changes to support SDK, including bin and sbin directories,
and modified make targets and names of some binary targets.  Calling
convention changed for perl distillers, so fixed html distiller and
added it as transend.text.html.  monitor.multicast property is now
Monitor.listen; all relevant code was changed.  Monitor can now parse
this from the options file.  Updated all UI changes from branch head.
@
text
@d50 1
@


1.36
log
@Changes, including some HACKS in dispatch.c, to support aggregator behavior.  New doc file explaining how to write them, but its out of date.  sample aggregators and new stuff in TACCutils.pm.  different syntax for specifying distillers/aggregators.
@
text
@d40 1
d98 1
@


1.35
log
@More nastyness.
@
text
@d102 1
@


1.34
log
@Changes to get PERL working.
@
text
@d88 2
a89 2
AC_CHECK_LIB(intl,dgettext,
            AC_CHECK_LIB(dl,dlopen,LIBS="$LIBS -lintl -ldl",AC_MSG_WARN("Found libintl but not libdl - Solaris will probably barf")))
@


1.33
log
@changed makefiles to work with new distiller stub, which links client_lib and therefore libmon
@
text
@d101 1
@


1.32
log
@links libperl correctly on linux
@
text
@d30 2
a31 1
    LDFLAGS="$LDFLAGS -L${withval}",
d34 1
d100 1
d115 1
@


1.32.2.1
log
@Type 1-style rewebber
@
text
@a105 1
          crypt_munger/Makefile
@


1.31
log
@Perl working on linux
@
text
@d28 1
a28 1
  --with-libperl=DIR      Look for libperl lib/ and include/ in DIR,
d56 8
a84 6

dnl Check for libperl headers and libraries

AC_CHECK_HEADER(perl.h,,AC_MSG_ERROR(Cannot find perl header files.  See the README for help.))
AC_CHECK_LIB(perl,perl_parse,DUMMY=,AC_MSG_ERROR(Cannot find libperl libraries.  See the README for help.),-lm -lsocket -lnsl)
dnl Check for libintl (and libdl) - solaris-specific lossage.
@


1.30
log
@Added "tcp_redirect" functionality
@
text
@d31 2
a32 2
    CPPFLAGS="$CPPFLAGS -I/usr/sww/lib/perl-5.002/CORE"
    LDFLAGS="$LDFLAGS -L/usr/sww/lib/perl-5.002/CORE"
d81 1
a81 1
AC_CHECK_LIB(perl,croak,DUMMY=,AC_MSG_ERROR(Cannot find libperl libraries.  See the README for help.),-lm -lsocket -lnsl)
@


1.30.2.1
log
@Get perl workoing on linux
@
text
@d31 2
a32 2
    CPPFLAGS="$CPPFLAGS -I/usr/sww/lib/perl5/CORE"
    LDFLAGS="$LDFLAGS -L/usr/sww/lib/perl5/CORE"
d81 1
a81 1
AC_CHECK_LIB(perl,perl_parse,DUMMY=,AC_MSG_ERROR(Cannot find libperl libraries.  See the README for help.),-lm -lsocket -lnsl)
@


1.30.2.2
log
@perl works now.
@
text
@d28 1
a28 1
  --with-libperl=DIR      Look for both perl.h and libperl.a in DIR,
a55 8

dnl Check for libperl headers and libraries

AC_CHECK_HEADER(perl.h,,AC_MSG_ERROR(Cannot find perl header files.  See the README for help.))
AC_CHECK_LIB(perl,croak,DUMMY=,AC_CHECK_LIB(perl,Perl_croak,DUMMY=,AC_MSG_ERROR(Cannot find libperl libraries.  See the README for help.),-lm $LIBS),-lm $LIBS)

dnl Check for libintl (and libdl) - solaris-specific lossage.

d77 6
@


1.29
log
@the perl_stub and perl_dir directories have been added
perl_stub has the source for the c stubs to allow for perl
distillers.

perl_dir is where the distillers live.  It is the location of the PERL_DIR
#define in config_tr.h
@
text
@d100 1
@


1.28
log
@config.h is now config_tr.h
@
text
@d8 1
a8 1
    LDFLAGS="-L${withval}/lib",
d10 1
a10 1
    LDFLAGS="-L/usr/sww/lib"
d15 1
a15 1
    LDFLAGS="-L${withval}/lib",
d17 1
a17 1
    LDFLAGS="-L/usr/sww/lib"
d22 1
a22 1
    LDFLAGS="-L${withval}/lib",
d24 9
a32 1
    LDFLAGS="-L/usr/sww/lib"
d77 5
d108 1
a108 1
	  perl_dist_stub/Makefile
@


1.27
log
@Added targets for the cache simulator.
@
text
@d3 1
a3 1
AC_CONFIG_HEADER(config.h)
d95 1
a95 1
	  monitor/Makefile
@


1.26
log
@Added purify stuff
@
text
@d92 1
@


1.25
log
@autoconf now finds gdbm
@
text
@d34 1
@


1.24
log
@Added stuff for giftojpg_munging..
@
text
@d19 7
d64 4
@


1.23
log
@Fixed up so that libjpeg.a isn't included all the time for all executables,
but now only for jpg_munge.
@
text
@d78 1
@


1.22
log
@Fixed up configure.in
@
text
@d56 1
a56 1
AC_CHECK_LIB(jpeg,jpeg_abort,,AC_MSG_ERROR(Cannot find libjpeg libraries.  See the README for help.),)
@


1.21
log
@Added skeleton for the jpeg munger, in jpg_munger.  Fixed up top-level
Makefile.in to include it, and fixed up configure.in to deal with
the needed libjpeg.a library.
@
text
@d16 1
a16 1
    CPPFLAGS="$CPPFLAGS -I/usr/sww/include"
d56 1
a56 1
AC_CHECK_LIB(jpeg,jpeg_create_compress,,AC_MSG_ERROR(Cannot find libjpeg libraries.  See the README for help.),)
@


1.20
log
@Added "dying gasp" functionality to MonitorClient class: whenever a new
monitor is created, globals are set to record its socket id and unit
name, so that the program can respond to signals by jumping to a signal
handler that announces the program's death by sending a death packet.
New functions in monitor.cc: DyingGasp (class method), GaspOnSignals
(instance method), extern "C" void MonitorClientSigHandler (C signal
handler), CurrentMonitorSock and CurrentUnitId (static variables in
monitor.h).  If you can think of a better way to do this, please change
it.

Fixed bug in frontend HTTP request parsing that caused multi-packet
requests not to be read correctly.

Many changes to the monitor, mostly cosmetic, some functional, including
addition of "kill" button (there is now a "death protocol") and more
sane show/hide behavior that is integrated with iconifying.
@
text
@d12 8
d53 4
d77 1
@


1.19
log
@Added doc/distillers.txt, which explains how to write your own
distiller.  Gifmunger should now do the right thing even on extremely
large images.  Default args for gifmunger are more sane (16 colors,
scale 0.5 per axis), but output still looks sucky - not sure why the
quantize phase picks such crappy colors.  "test_http" program has been
officially renamed "frontend".  Fixed the "run" targets in toplevel
Makefile.  Added line to configure.in to create a Makefile from
Makefile.in for gui.
@
text
@d53 1
a53 1
INCLUDEPATH=".. ../frontend/include ../client_lib/include ../ptm/include ../monitor/include ../playback/include"
@


1.18
log
@Top level makefile now works.
@
text
@d67 1
@


1.17
log
@Hacked up so that test_harvest.c will compile in linux, due to pthread_attr.h
gross structure field changes in sched_attr structure.
@
text
@d23 1
@


1.16
log
@*** empty log message ***
@
text
@d36 1
a36 1
AC_CHECK_HEADERS(time.h sys/time.h sys/timers.h pthread.h)
d38 2
@


1.15
log
@*** empty log message ***
@
text
@d36 1
a36 1
AC_CHECK_HEADERS(time.h sys/time.h sys/timers.h sys/foobar.h pthread.h)
d41 1
a41 1
AC_CHECK_LIB(pnm,pnm_init,,AC_MSG_ERROR(Cannot find NetPBM libraries.  See the README for help.),-lppm -lpgm -lpbm -lm)
d45 1
a45 1
            AC_CHECK_LIB(dl,dlopen,LIBS="$LIBS -lintl -ldl",AC_MSG_WARN("Cannot find libintl or libdl - Solaris will probably barf")))
@


1.14
log
@Put pthread.h check in the right place.
@
text
@a23 3
builtin(include, configure.in.tcl)
builtin(include, configure.in.tk)

d47 3
d64 1
a64 1
	  gui/Makefile
@


1.13
log
@Put some SYS_TIME TIME and TIMERS headers in the config.h.in and
configure.in scripts (SG)
@
text
@d39 1
a39 1
AC_CHECK_HEADERS(time.h sys/time.h sys/timers.h sys/foobar.h)
a52 1
AC_CHECK_HEADER(pthread.h)
@


1.12
log
@Changed the configure script to include tcl/tk correctly
@
text
@d38 3
@


1.11
log
@Update after merging config.h.in
@
text
@d2 1
d4 1
d12 1
a12 7
AC_ARG_WITH(tcl,
  --with-tcl=DIR         Look for Tcl >=7.5 in lib/ and include/ in DIR,
    TCLLIBS="-L${withval}/lib -ltcl"
    TCLINCLUDE="${withval}/include",
    TCLLIBS="-L/usr/sww/lib -ltcl"
    TCLINCLUDE="/usr/sww/include"
)
d14 1
a14 1
CFLAGS=-g
d24 3
a31 3
AC_DEFINE(_REENTRANT)
AC_DEFINE(_MIT_POSIX_THREADS)

d62 1
@


1.10
log
@minor changes to autoconfig stuff
@
text
@d18 1
d65 1
@


1.9
log
@fixed pthreads stuff in configure.in, and made it able to find tcl
library for linking the tcl-udp extension used for the GUI monitor.
@
text
@d6 10
a15 1
    LDFLAGS="-L${withval}/lib"
@


1.8
log
@pthreads and pthread now checked for
@
text
@d3 5
d26 14
a39 6
AC_CHECK_LIB(pthread,pthread_create,
        LIBS="$LIBS -lpthread")
AC_CHECK_LIB(pthreads,pthread_create,
	LIBS="$LIBS -lpthreads")
AC_CHECK_LIB(socket,socket,
        LIBS="$LIBS -lsocket -lnsl")
d53 1
@


1.7
log
@configure script now generates include path automatically
@
text
@d23 2
d28 1
a28 1
INCLUDEPATH=".. ../frontend/include ../client_lib/include ../ptm/include ../monitor/include"
d40 1
@


1.6
log
@moved some machine-dependent and compiler-dependent stuff that is
generally useful into config.h.in; now check for perl and some libraries
(solaris socket stuff) in configure.in
@
text
@d26 2
d30 3
@


1.5
log
@added Makefile.in for client_lib and client_lib/src, fixed malloc
wrappers in config.h.in
@
text
@d11 1
d28 6
a33 1
AC_OUTPUT(Makefile frontend/Makefile client_lib/Makefile client_lib/src/Makefile)
@


1.4
log
@cleaned up and added some stuff to autoconf files
@
text
@d6 1
a6 1
      CFLAGS="-ansi -Wall -pedantic $CFLAGS"
d17 3
d25 1
d27 1
a27 1
AC_OUTPUT(Makefile frontend/Makefile)
@


1.3
log
@Makefile.in for autoconf
@
text
@d23 1
a23 1
AC_OUTPUT(Makefile)
@


1.2
log
@Threads have signs of life
@
text
@d2 10
a11 1
AC_CONFIG_HEADER(include/config.h)
d14 8
a21 1
AC_CHECK_LIB(pthread,pthread_create)
@


1.1
log
@Do this right from the beginning, using autoconf.
@
text
@d2 3
@
