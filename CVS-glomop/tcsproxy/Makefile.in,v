head	1.77;
access;
symbols
	Yatin-final:1.70.2.1
	Yatin:1.70.0.2
	pre-yatin-merge:1.70
	transend-beta2:1.61
	fox-dev:1.60.4.1
	transend-ng:1.48
	transend-beta-latest:1.48
	Aggregators:1.47
	NoAggregators:1.47
	iang:1.42.0.4
	transend-beta:1.42.0.2
	SOSP:1.33
	merged_preintegrate:1.9
	heisenbug:1.8
	PRE_INTEGRATION:1.8;
locks; strict;
comment	@# @;


1.77
date	98.06.08.20.11.22;	author fox;	state Exp;
branches;
next	1.76;

1.76
date	98.01.22.00.29.39;	author transend;	state Exp;
branches;
next	1.75;

1.75
date	98.01.22.00.21.52;	author transend;	state Exp;
branches;
next	1.74;

1.74
date	98.01.21.04.29.12;	author transend;	state Exp;
branches;
next	1.73;

1.73
date	98.01.16.22.15.43;	author yatin;	state Exp;
branches;
next	1.72;

1.72
date	97.12.15.05.36.42;	author tkimball;	state Exp;
branches;
next	1.71;

1.71
date	97.12.15.04.57.15;	author tkimball;	state Exp;
branches;
next	1.70;

1.70
date	97.11.12.23.43.15;	author yatin;	state Exp;
branches
	1.70.2.1;
next	1.69;

1.69
date	97.11.05.21.59.48;	author iang;	state Exp;
branches;
next	1.68;

1.68
date	97.10.26.20.08.53;	author iang;	state Exp;
branches;
next	1.67;

1.67
date	97.10.05.19.26.47;	author iang;	state Exp;
branches;
next	1.66;

1.66
date	97.09.26.01.43.47;	author fox;	state Exp;
branches;
next	1.65;

1.65
date	97.09.19.01.28.33;	author yatin;	state Exp;
branches;
next	1.64;

1.64
date	97.09.18.22.45.11;	author yatin;	state Exp;
branches;
next	1.63;

1.63
date	97.09.12.02.30.47;	author fox;	state Exp;
branches;
next	1.62;

1.62
date	97.08.30.21.33.48;	author fox;	state Exp;
branches;
next	1.61;

1.61
date	97.08.16.05.30.12;	author fox;	state Exp;
branches;
next	1.60;

1.60
date	97.07.30.02.28.13;	author fox;	state Exp;
branches
	1.60.4.1;
next	1.59;

1.59
date	97.07.26.00.29.35;	author fox;	state Exp;
branches;
next	1.58;

1.58
date	97.07.25.03.37.34;	author fox;	state Exp;
branches;
next	1.57;

1.57
date	97.07.23.23.54.41;	author yatin;	state Exp;
branches;
next	1.56;

1.56
date	97.07.22.02.15.40;	author fox;	state Exp;
branches;
next	1.55;

1.55
date	97.07.15.02.42.59;	author fox;	state Exp;
branches;
next	1.54;

1.54
date	97.06.12.18.31.25;	author fox;	state Exp;
branches;
next	1.53;

1.53
date	97.06.06.01.09.03;	author gribble;	state Exp;
branches;
next	1.52;

1.52
date	97.06.06.00.28.07;	author gribble;	state Exp;
branches;
next	1.51;

1.51
date	97.06.06.00.25.14;	author gribble;	state Exp;
branches;
next	1.50;

1.50
date	97.06.06.00.07.34;	author fox;	state Exp;
branches;
next	1.49;

1.49
date	97.06.04.02.15.32;	author fox;	state Exp;
branches;
next	1.48;

1.48
date	97.06.04.01.14.33;	author fox;	state Exp;
branches;
next	1.47;

1.47
date	97.05.14.03.26.24;	author gribble;	state Exp;
branches;
next	1.46;

1.46
date	97.05.14.03.19.25;	author fox;	state Exp;
branches;
next	1.45;

1.45
date	97.05.14.03.09.53;	author gribble;	state Exp;
branches;
next	1.44;

1.44
date	97.05.11.10.16.46;	author fox;	state Exp;
branches;
next	1.43;

1.43
date	97.05.01.00.58.06;	author gribble;	state Exp;
branches;
next	1.42;

1.42
date	97.04.27.06.22.41;	author fox;	state Exp;
branches
	1.42.2.1
	1.42.4.1;
next	1.41;

1.41
date	97.04.24.21.25.03;	author gribble;	state Exp;
branches;
next	1.40;

1.40
date	97.04.21.22.36.53;	author aspolito;	state Exp;
branches;
next	1.39;

1.39
date	97.04.18.23.35.31;	author fox;	state Exp;
branches;
next	1.38;

1.38
date	97.04.18.21.58.49;	author yatin;	state Exp;
branches;
next	1.37;

1.37
date	97.04.09.02.59.21;	author yatin;	state Exp;
branches;
next	1.36;

1.36
date	97.04.07.22.42.06;	author yatin;	state Exp;
branches;
next	1.35;

1.35
date	97.04.07.20.33.02;	author yatin;	state Exp;
branches;
next	1.34;

1.34
date	97.04.07.01.55.24;	author yatin;	state Exp;
branches;
next	1.33;

1.33
date	97.03.06.08.30.47;	author fox;	state Exp;
branches;
next	1.32;

1.32
date	97.02.22.08.35.01;	author gribble;	state Exp;
branches;
next	1.31;

1.31
date	97.02.19.01.31.12;	author aspolito;	state Exp;
branches;
next	1.30;

1.30
date	97.02.16.05.41.49;	author yatin;	state Exp;
branches;
next	1.29;

1.29
date	97.02.08.03.19.52;	author gribble;	state Exp;
branches;
next	1.28;

1.28
date	97.02.08.03.06.29;	author fox;	state Exp;
branches;
next	1.27;

1.27
date	97.02.07.03.41.02;	author fox;	state Exp;
branches;
next	1.26;

1.26
date	97.02.07.03.26.46;	author fox;	state Exp;
branches;
next	1.25;

1.25
date	97.02.06.03.18.26;	author gribble;	state Exp;
branches;
next	1.24;

1.24
date	97.02.05.19.53.55;	author fox;	state Exp;
branches;
next	1.23;

1.23
date	97.02.05.19.52.38;	author fox;	state Exp;
branches;
next	1.22;

1.22
date	97.02.05.03.56.57;	author fox;	state Exp;
branches;
next	1.21;

1.21
date	97.02.05.00.32.52;	author fox;	state Exp;
branches;
next	1.20;

1.20
date	97.02.02.04.16.14;	author gribble;	state Exp;
branches;
next	1.19;

1.19
date	97.01.30.22.05.09;	author fox;	state Exp;
branches;
next	1.18;

1.18
date	97.01.29.23.55.43;	author fox;	state Exp;
branches;
next	1.17;

1.17
date	97.01.28.23.37.39;	author gribble;	state Exp;
branches;
next	1.16;

1.16
date	97.01.28.03.57.23;	author fox;	state Exp;
branches;
next	1.15;

1.15
date	97.01.24.01.24.56;	author gribble;	state Exp;
branches;
next	1.14;

1.14
date	97.01.23.23.10.33;	author gribble;	state Exp;
branches;
next	1.13;

1.13
date	97.01.22.22.52.37;	author aspolito;	state Exp;
branches;
next	1.12;

1.12
date	97.01.22.22.28.37;	author aspolito;	state Exp;
branches;
next	1.11;

1.11
date	97.01.06.05.43.22;	author fox;	state Exp;
branches;
next	1.10;

1.10
date	96.12.16.07.34.50;	author fox;	state Exp;
branches;
next	1.9;

1.9
date	96.12.15.23.35.46;	author fox;	state Exp;
branches;
next	1.8;

1.8
date	96.12.13.00.54.26;	author fox;	state Exp;
branches;
next	1.7;

1.7
date	96.12.13.00.18.31;	author fox;	state Exp;
branches;
next	1.6;

1.6
date	96.12.12.03.18.13;	author gribble;	state Exp;
branches;
next	1.5;

1.5
date	96.12.12.03.12.21;	author gribble;	state Exp;
branches;
next	1.4;

1.4
date	96.12.12.02.18.20;	author fox;	state Exp;
branches;
next	1.3;

1.3
date	96.12.05.01.15.03;	author gribble;	state Exp;
branches;
next	1.2;

1.2
date	96.10.27.22.04.49;	author fox;	state Exp;
branches;
next	1.1;

1.1
date	96.10.26.00.57.19;	author fox;	state Exp;
branches;
next	;

1.42.2.1
date	97.04.27.19.09.44;	author gribble;	state Exp;
branches;
next	;

1.42.4.1
date	97.05.06.23.49.22;	author iang;	state Exp;
branches;
next	1.42.4.2;

1.42.4.2
date	97.05.08.23.28.57;	author iang;	state Exp;
branches;
next	;

1.60.4.1
date	97.08.11.04.13.37;	author fox;	state Exp;
branches;
next	;

1.70.2.1
date	97.12.02.21.04.33;	author iang;	state Exp;
branches;
next	;


desc
@@


1.77
log
@added stuff to configure.in to support java stub compilation (include
and lib paths for java runtime and VM); to toplevel Makefile to support
conditional compilation of java stub (if --enable-java is given to
configure); added java_stub.c and Makefile.in (based on their
counterparts from perl_stub).  The java stub will be designed so that
Servlets can be loaded directly into it, ie it will expect to load a
classfile that implements a subclass of Servlet, and then have
DistillerInit() and DistillerMain() call the servlet's init and main
functions respectively.
@
text
@WISH = @@WISH@@
PERL = @@PERL@@

USER = $(shell whoami)
ifndef OPTIONS	
OPTIONS  = gm_options.$(USER)
endif
RATE = 3

#all: gui ptm client_lib frontend html_munger gif_munger playback\
#     jpg_munger giftojpg_munger cached-1.4.pl3 tags

TARGETS = gui ptm client_lib frontend perl_stub html_munger jpg_munger \
		giftojpg_munger Tbmp_munger 2bit_munger text2doc \
		@@TCL_STUB_TARGET@@ @@JAVA_STUB_TARGET@@ playback TAGS
DISTTARGETS =   gui_dist ptm_dist frontend_dist perl_stub_dist \
		html_munger_dist jpg_munger_dist giftojpg_munger_dist \
		Tbmp_munger_dist 2bit_munger_dist text2doc_dist 
DISTTARGETS =   doc_dist gui_dist ptm_dist frontend_dist perl_stub_dist\
		html_munger_dist jpg_munger_dist giftojpg_munger_dist\
		Tbmp_munger_dist 2bit_munger_dist text2doc_dist\
		xs_dist perl_dir_force

# for now omit targets gif_munger,tcp_redirect

CLEANENV = unset SSH_TTY SSH_CLIENT SSH_AUTHENTICATION_SOCKET SSH_AUTH_SOCK
CLEANDENV = $(CLEANENV); unset DISPLAY

all:  $(TARGETS)

install: $(TARGETS)

wingman: gui ptm client_lib frontend perl_stub 2bit_munger text2doc \
	@@TCL_STUB_TARGET@@ TAGS

run_dist: $(DISTTARGETS)

check: FORCE
	ldd sbin/frontend
	ldd sbin/ptm
	ldd sbin/html_munger
	ldd sbin/giftojpg_munger
	ldd sbin/gif_munger
	ldd sbin/jpg_munger
	ldd sbin/perl_stub
	ldd sbin/2bit_munger
	ldd sbin/text2doc

sdk: install
	tar -cf - bin sbin lib doc gui perl_dir xs | gzip - > sdk.tgz

run: run_monitor run_ptm run_frontend

run_monitor:
	$(CLEANENV); $(WISH) sbin/monitor.tcl -name monitor ../$(OPTIONS) & 

run_ptm:
	$(CLEANDENV); sbin/ptm -o $(OPTIONS) 2> ptm.errs &

run_frontend: 
	$(CLEANDENV); sbin/frontend $(OPTIONS) 2> frontend.errs &

run_fe_check:
	$(CLEANDENV); $(PERL) frontend/src/fe_check.pl $(OPTIONS) 30 &

run_tcp_redirect:
	cd tcp_redirect; ./tcp_redirect ../$(OPTIONS) 2> tcp_redirect.errs &

run_tr_check:
	tcp_redirect/src/tr_check.pl $(OPTIONS) 30 &

run_html_munger:
	sbin/html_munger -o $(OPTIONS) -t transend/text/html &

run_giftojpg_munger:
	sbin/giftojpg_munger -o $(OPTIONS) -t transend/image/gif &

run_jpg_munger:
	sbin/jpg_munger -o $(OPTIONS) -t transend/image/jpeg &

blast: FORCE
	ulimit descriptors
	playback/bp_engine 127.0.0.1 $(shell grep -i listen_port $(OPTIONS) | cut -f 2 -d :) $(RATE) 9999 < ~gribble/working/tcsproxy/playback/848220425.log.univ

ptm: FORCE
	cd ptm; $(MAKE) install

client_lib: FORCE
	cd client_lib; $(MAKE) install

frontend: client_lib ptm gui FORCE
	cd frontend; $(MAKE) install

gui: FORCE
	cd gui; $(MAKE) install

java_stub: ptm gui client_lib FORCE
	cd java_stub; $(MAKE) install

perl_stub: ptm gui xs client_lib FORCE 
	cd perl_stub; $(MAKE) install

tcl_stub: ptm gui FORCE
	cd tcl_stub; $(MAKE) install

xs: client_lib FORCE
	cd xs; $(PERL) Makefile.PL; $(MAKE) install

html_munger: ptm gui FORCE
	cd html_munger; $(MAKE) install

tcp_redirect: ptm gui FORCE
	cd tcp_redirect; $(MAKE) install

gif_munger: ptm gui FORCE
	cd gif_munger; $(MAKE) install

jpg_munger: ptm gui FORCE
	cd jpg_munger; $(MAKE) install

Tbmp_munger: ptm gui FORCE
	cd Tbmp_munger; $(MAKE) install

giftojpg_munger: ptm gui FORCE
	cd giftojpg_munger; $(MAKE) install

2bit_munger: ptm gui FORCE
	cd 2bit_munger; $(MAKE) install

text2doc: ptm gui FORCE
	cd text2doc; $(MAKE) install

playback: client_lib FORCE
	cd playback; $(MAKE)

cached-1.4.pl3: FORCE
	-cd cached-1.4.pl3; $(MAKE)

clean: FORCE
	-cd sbin; /bin/rm -f *
	cd ptm; $(MAKE) clean
	cd client_lib; $(MAKE) clean
	cd frontend; $(MAKE) clean
	cd gui; $(MAKE) clean
	cd html_munger; $(MAKE) clean
	cd tcp_redirect; $(MAKE) clean
	cd gif_munger; $(MAKE) clean
	cd jpg_munger; $(MAKE) clean
	cd perl_stub; $(MAKE) clean
	-cd xs; /bin/rm -rf blib lib Makefile
	cd giftojpg_munger; $(MAKE) clean
	cd 2bit_munger; $(MAKE) clean
	cd text2doc; $(MAKE) clean
	cd playback; $(MAKE) clean
	-/bin/rm config.cache config.log config.status *~

TAGS: FORCE
	find . -name cached-\* -prune -o -name squid\* -prune -o -name \*.c -print -o -name \*.cc -print -o -name \*.h -print | etags -

FORCE:

doc_dist: FORCE
	mkdir -p new_dist/doc
	mkdir -p new_dist/about
	-cp -f doc/* new_dist/doc
	-cp -f about/* new_dist/about
	-cp -f dist/tcsproxy/* new_dist

gui_dist: FORCE
	mkdir -p new_dist/sbin
	-cp -f gui/tudp.so new_dist/sbin
	-cp -f gui/*.tcl new_dist/sbin
	-chmod +x new_dist/sbin/*.tcl

ptm_dist: FORCE
	mkdir -p new_dist/sbin
	-cp -f ptm/ptm new_dist/sbin

frontend_dist: FORCE
	mkdir -p new_dist/sbin
	-cp -f frontend/frontend new_dist/sbin
	-cp -f frontend/src/fe_check.pl new_dist/sbin

perl_stub_dist: FORCE
	mkdir -p new_dist/sbin
	-cp -f perl_stub/perl_stub new_dist/sbin

html_munger_dist: FORCE
	mkdir -p new_dist/sbin
	-cp -f html_munger/html_munger new_dist/sbin

jpg_munger_dist: FORCE
	mkdir -p new_dist/sbin
	-cp -f jpg_munger/jpg_munger new_dist/sbin

giftojpg_munger_dist: FORCE
	mkdir -p new_dist/sbin
	-cp -f giftojpg_munger/giftojpg_munger new_dist/sbin

Tbmp_munger_dist: FORCE
	mkdir -p new_dist/sbin
	-cp -f Tbmp_munger/Tbmp_munger new_dist/sbin

2bit_munger_dist: FORCE
	mkdir -p new_dist/sbin
	-cp -f 2bit_munger/2bit_munger new_dist/sbin

text2doc_dist: FORCE
	mkdir -p new_dist/sbin
	-cp -f text2doc/text2doc new_dist/sbin

xs_dist: FORCE
	mkdir -p new_dist/xs/lib
	-cp -rf xs/lib/* new_dist/xs/lib

perl_dir_force: FORCE
	mkdir -p new_dist/perl_dir
	-cp -f perl_dir/* new_dist/perl_dir



@


1.76
log
@.
@
text
@d15 1
a15 1
		@@TCL_STUB_TARGET@@ playback TAGS
d97 4
a100 1
perl_stub: ptm gui xs FORCE 
@


1.75
log
@.
@
text
@d58 1
a58 1
	$(CLEANDENV); sbin/ptm -o $(OPTIONS) &
@


1.74
log
@.
@
text
@d26 1
a26 1
CLEANENV = unset SSH_TTY SSH_CLIENT SSH_AUTHENTICATION_SOCKET
@


1.73
log
@- new wingman frontend
- new wingman aggregators mechanism
- DistillAsync

(merged from branch Yatin-final)
@
text
@d64 1
a64 1
	$(CLEANDENV); frontend/src/fe_check.pl $(OPTIONS) 30 &
@


1.72
log
@Commiting new makefile..
@
text
@d26 3
d55 1
a55 1
	$(WISH) sbin/monitor.tcl -name monitor ../$(OPTIONS) & 
d58 1
a58 1
	sbin/ptm -o $(OPTIONS) &
d61 1
a61 1
	sbin/frontend $(OPTIONS) 2> frontend.errs &
d64 1
a64 1
	frontend/src/fe_check.pl $(OPTIONS) 30 &
@


1.71
log
@Commiting any files that need commiting!
@
text
@d19 4
d161 1
d166 2
d212 3
@


1.70
log
@moved from mash_stub to tcl_stub
@
text
@d16 4
d29 2
d151 54
@


1.70.2.1
log
@.
@
text
@a17 3
CLEANENV = unset SSH_TTY SSH_CLIENT SSH_AUTHENTICATION_SOCKET
CLEANDENV = $(CLEANENV); unset DISPLAY

d42 1
a42 1
	$(CLEANENV); $(WISH) sbin/monitor.tcl -name monitor ../$(OPTIONS) & 
d45 1
a45 1
	$(CLEANDENV); sbin/ptm -o $(OPTIONS) &
d48 1
a48 1
	$(CLEANDENV); sbin/frontend $(OPTIONS) 2> frontend.errs &
d51 1
a51 1
	$(CLEANDENV); frontend/src/fe_check.pl $(OPTIONS) 30 &
@


1.69
log
@Added text-to-doc conversion
@
text
@d15 1
a15 1
		@@MASH_STUB_TARGET@@ playback TAGS
d23 1
a23 1
	@@MASH_STUB_TARGET@@ TAGS
d87 2
a88 5
mash_stub: ptm gui libsmash.o FORCE
	cd mash_stub; $(MAKE) install

libsmash.o: FORCE
	@@MAKE_LIBSMASH_O@@
@


1.68
log
@Added wingman target for faster wingman compilation
@
text
@d14 1
a14 1
		giftojpg_munger Tbmp_munger 2bit_munger \
d22 1
a22 1
wingman: gui ptm client_lib frontend perl_stub 2bit_munger \
d33 2
d117 3
d140 1
@


1.67
log
@2-bit image distillation is now faster and better quality
@
text
@d22 3
@


1.66
log
@inter distiller calling seems to work in context of pilot perl distiller
@
text
@d14 2
a15 1
		giftojpg_munger Tbmp_munger @@MASH_STUB_TARGET@@ playback TAGS
d109 3
d131 1
@


1.65
log
@bug fixes
@
text
@d14 1
a14 1
		giftojpg_munger @@MASH_STUB_TARGET@@ playback TAGS
d101 3
@


1.64
log
@added mash_stub
mash_stub is compiled only if --with-mashdir flag is set
added a --enable/disable-mkdep flag to configure
configure can read default arguments from a special file .configure in
the toplevel tcsproxy directory
@
text
@a126 3
depend: FORCE
	cd ptm; $(MAKE) depend

@


1.63
log
@*** empty log message ***
@
text
@d14 1
a14 1
		giftojpg_munger playback TAGS
d81 6
d126 3
@


1.62
log
@reintegrated from branch fox-dev; bug remaining in dispatch.c which should always return a DistillerStatus and not an HTTP_Status
@
text
@d5 2
a6 2
ifndef GM_OPTIONS	
GM_OPTIONS  = gm_options.$(USER)
d36 1
a36 1
	$(WISH) sbin/monitor.tcl -name monitor ../$(GM_OPTIONS) & 
d39 1
a39 1
	sbin/ptm -o $(GM_OPTIONS) &
d42 1
a42 1
	sbin/frontend $(GM_OPTIONS) 2> frontend.errs &
d45 1
a45 1
	frontend/src/fe_check.pl $(GM_OPTIONS) 30 &
d48 1
a48 1
	cd tcp_redirect; ./tcp_redirect ../$(GM_OPTIONS) 2> tcp_redirect.errs &
d51 1
a51 1
	tcp_redirect/src/tr_check.pl $(GM_OPTIONS) 30 &
d54 1
a54 1
	sbin/html_munger -o $(GM_OPTIONS) -t transend/text/html &
d57 1
a57 1
	sbin/giftojpg_munger -o $(GM_OPTIONS) -t transend/image/gif &
d60 1
a60 1
	sbin/jpg_munger -o $(GM_OPTIONS) -t transend/image/jpeg &
d64 1
a64 1
	playback/bp_engine 127.0.0.1 $(shell grep -i listen_port $(GM_OPTIONS) | cut -f 2 -d :) $(RATE) 9999 < ~gribble/working/tcsproxy/playback/848220425.log.univ
@


1.61
log
@Removed the cached target from 'make clean'.
@
text
@d5 3
a7 1
OPTIONS  = gm_options.$(USER)
d13 16
a28 4
install: all

all: gui ptm client_lib frontend perl_stub html_munger playback\
	tcp_redirect jpg_munger giftojpg_munger tags # gif_munger
d31 1
a31 1
	gtar -zcf sdk.tgz bin sbin lib doc gui perl_dir xs
d36 1
a36 1
	$(WISH) sbin/monitor.tcl -name monitor ../$(OPTIONS) & 
d39 1
a39 1
	sbin/ptm -o $(OPTIONS) &
d42 1
a42 1
	sbin/frontend $(OPTIONS) 2> frontend.errs &
d45 1
a45 1
	frontend/src/fe_check.pl $(OPTIONS) 30 &
d48 1
a48 1
	cd tcp_redirect; ./tcp_redirect ../$(OPTIONS) 2> tcp_redirect.errs &
d51 1
a51 1
	tcp_redirect/src/tr_check.pl $(OPTIONS) 30 &
d54 1
a54 1
	sbin/html_munger -o $(OPTIONS) -t transend/text/html &
d57 1
a57 1
	sbin/giftojpg_munger -o $(OPTIONS) -t transend/image/gif &
d60 1
a60 1
	sbin/jpg_munger -o $(OPTIONS) -t transend/image/jpeg &
d64 1
a64 1
	playback/bp_engine 127.0.0.1 $(shell grep -i listen_port $(OPTIONS) | cut -f 2 -d :) $(RATE) 9999 < ~gribble/working/tcsproxy/playback/848220425.log.univ
d121 1
a121 1
tags: 
@


1.60
log
@Toplevel Makefile slimmed down.  lib/ subdir and corresponding install
targets added, to prep for binary dist.  client_lib now has
strerror()-style error reporting.  Fixed bug in dispatch.c that caused
prefs call for an aggregator to coredump (strcpy called on null ptr).
text/html distiller more streamlined and correctly "munges" user prefs
form items.  GetOptions moved from clib to TaccUtils.  perl_stub now
passes arguments named "s11", "i2", etc. instead of "11", "2", etc.
@
text
@a104 1
	cd cached-1.4.pl3; $(MAKE) clean
@


1.60.4.1
log
@armandos development version for rebuilding the frontend - do not use
@
text
@d5 1
a5 3
ifndef GM_OPTIONS	
GM_OPTIONS  = gm_options.$(USER)
endif
d11 4
a14 16
TARGETS = gui ptm client_lib frontend perl_stub html_munger jpg_munger \
		giftojpg_munger playback TAGS
# for now omit targets gif_munger,tcp_redirect

all:  $(TARGETS)

install: $(TARGETS)

check: FORCE
	ldd sbin/frontend
	ldd sbin/ptm
	ldd sbin/html_munger
	ldd sbin/giftojpg_munger
	ldd sbin/gif_munger
	ldd sbin/jpg_munger
	ldd sbin/perl_stub
d17 1
a17 1
	tar -cf - bin sbin lib doc gui perl_dir xs | gzip - > sdk.tgz
d22 1
a22 1
	$(WISH) sbin/monitor.tcl -name monitor ../$(GM_OPTIONS) & 
d25 1
a25 1
	sbin/ptm -o $(GM_OPTIONS) &
d28 1
a28 1
	sbin/frontend $(GM_OPTIONS) 2> frontend.errs &
d31 1
a31 1
	frontend/src/fe_check.pl $(GM_OPTIONS) 30 &
d34 1
a34 1
	cd tcp_redirect; ./tcp_redirect ../$(GM_OPTIONS) 2> tcp_redirect.errs &
d37 1
a37 1
	tcp_redirect/src/tr_check.pl $(GM_OPTIONS) 30 &
d40 1
a40 1
	sbin/html_munger -o $(GM_OPTIONS) -t transend/text/html &
d43 1
a43 1
	sbin/giftojpg_munger -o $(GM_OPTIONS) -t transend/image/gif &
d46 1
a46 1
	sbin/jpg_munger -o $(GM_OPTIONS) -t transend/image/jpeg &
d50 1
a50 1
	playback/bp_engine 127.0.0.1 $(shell grep -i listen_port $(GM_OPTIONS) | cut -f 2 -d :) $(RATE) 9999 < ~gribble/working/tcsproxy/playback/848220425.log.univ
d108 1
a108 1
TAGS: FORCE
@


1.59
log
@makefile fixes to have lib/ subdir now work on both.  anonymization added to frontend.  still a lurking stack-stomping bug in httpsupport.c
@
text
@d1 1
a1 6
LIBS = @@LIBS@@
CFLAGS = @@CFLAGS@@ -D_MIT_POSIX_THREADS -D_REENTRANT -DDEBUGGING -g
CC = @@CC@@
HAVE_TIME_H = @@HAVE_TIME_H@@
INCLUDEPATH = @@INCLUDEPATH@@
MAKE = @@MAKEEX@@
a2 1
WISH = @@WISH@@
a6 1
# MON_OPTIONS  = monitor.options.$(USER)
@


1.58
log
@evil bug in parse_status_and_headers was overwriting caller stack and
causing coredumps....we flushed it out of hiding by forcing everything
to bypass.  still need to test steve's changes and retrofit the new
mechanism for dealing with push.jpg.
@
text
@d24 1
a24 1
	gtar -zcf sdk.tgz bin sbin doc gui
d63 1
a63 1
	cd client_lib; $(MAKE)
@


1.57
log
@modified distiller stub and ptm to handle "--" correctly for additional
distiller arguments

modified distiller stubs to read the multicast addresses from the options
file instead of accepting them on the command line

added run targets for html, gig and jpg mungers
@
text
@d99 1
a99 1
	-cd bin; /bin/rm -f *
@


1.56
log
@fixed makefile bugs to compile under both linux and solaris
@
text
@d46 9
@


1.55
log
@makefile changes to link pthreads only at end, which was causing severe bad behaviors under linux since different people were calling different signal()s.  SIGHUP is now used instead of SIGUSR1 to signal components to reinitialize themselves, and SIGTERM is used to kill them gracefully.  Layout stuff for Pilot works but is still inelegant.
@
text
@d56 1
a56 1
frontend: client_lib ptm gui
@


1.54
log
@various changes to makefiles to support auto-installation into sbin and bin directories.  perl HTML distiller no longer inserts UI in pages with frames.  PREFS_URL and similar strings are now static char* instead of #defines, but still need them to be initialized in PTM stub so distillers can get at them.  "run" targets are better now, they run stuff from the sbin and bin directories.
@
text
@d107 1
a107 1
	find . -name cached-\* -prune -o -name \*.c -print -o -name \*.cc -print -o -name \*.h -print | etags -
@


1.53
log
@Fixed up so that both Armando and I are happy...
@
text
@d8 1
a8 1
INSTALL = @@INSTALL@@ -s
d29 1
a29 1
	cd gui; $(WISH) ./monitor.tcl -name monitor ../$(OPTIONS) & 
d51 1
a51 2
	cd ptm; $(MAKE)
	$(INSTALL) $@@/$@@ sbin/$@@
d57 1
a57 2
	cd frontend; $(MAKE)
	$(INSTALL) $@@/$@@ sbin/$@@
d60 1
a60 1
	cd gui; $(MAKE)
d63 1
a63 2
	cd perl_stub; $(MAKE)
	$(INSTALL) $@@/$@@ sbin/$@@
d69 1
a69 2
	cd html_munger; $(MAKE)
	$(INSTALL) $@@/$@@ bin/$@@
d72 1
a72 1
	cd tcp_redirect; $(MAKE)
d75 1
a75 2
	cd gif_munger; $(MAKE)
	$(INSTALL) $@@/$@@ bin/$@@
d78 1
a78 2
	cd jpg_munger; $(MAKE)
	$(INSTALL) $@@/$@@ bin/$@@
d81 1
a81 2
	cd giftojpg_munger; $(MAKE)
	$(INSTALL) $@@/$@@ bin/$@@
d90 1
a90 1
	cd bin; /bin/rm -f *
@


1.52
log
@And another tweak to run frontend
@
text
@d32 1
a32 1
	cd sbin; ./ptm -o ../$(OPTIONS) &
@


1.51
log
@Snafu with PTM target.
@
text
@d35 1
a35 1
	sbin/frontend -o $(OPTIONS) 2> frontend.errs &
@


1.50
log
@Many changes to support SDK, including bin and sbin directories,
and modified make targets and names of some binary targets.  Calling
convention changed for perl distillers, so fixed html distiller and
added it as transend.text.html.  monitor.multicast property is now
Monitor.listen; all relevant code was changed.  Monitor can now parse
this from the options file.  Updated all UI changes from branch head.
@
text
@d32 1
a32 1
	sbin/ptm -o $(OPTIONS) &
@


1.49
log
@changes to Makefile.in at toplevel to fix xs make, and removed __INSTRUMENT__ def from ptm makefile.in
@
text
@d8 1
a13 1
MONITOR_ADDR = $(shell sed -n 's/monitor.multicast: *//p' $(OPTIONS))
d16 3
a18 1
#     jpg_munger gifjpg_munger cached-1.4.pl3 tags
d21 4
a24 1
     tcp_redirect jpg_munger gifjpg_munger tags # gif_munger
d29 1
a29 1
	cd gui; ./monitor.tcl ../$(OPTIONS) -multicast $(MONITOR_ADDR) &
d32 1
a32 1
	cd ptm; ./ptm -o ../$(OPTIONS) &
d35 1
a35 1
	cd frontend; ./frontend ../$(OPTIONS) 2> frontend.errs &
d52 1
d59 1
d66 1
d73 1
d80 1
d84 1
d86 1
a86 1
gifjpg_munger: ptm gui FORCE
d88 1
d97 1
@


1.48
log
@merged in changes from head of transend-beta branch
@
text
@d94 1
a94 1
	cd xs; $(MAKE) realclean
@


1.47
log
@cwd hack
@
text
@d36 4
a39 1
	cd tcp_redirect; ./tcp_redirect ../$(OPTIONS) &
@


1.46
log
@*** empty log message ***
@
text
@d58 1
a58 1
	cd xs; $(PERL) Makefile.PL PREFIX=$$cwd INSTALLDIRS=perl; $(MAKE) install
@


1.45
log
@Changes to get PERL working.
@
text
@d58 1
a58 1
	cd xs; $(PERL) Makefile.PL PREFIX=$$cwd INSTALLDIRS=perl; $(MAKE)
d91 1
@


1.44
log
@changed makefiles to work with new distiller stub, which links client_lib and therefore libmon
@
text
@d7 1
d58 1
a58 1
	cd xs; $(PERL) Makefile.PL PREFIX=$$cwd INSTALLDIRS=perl
@


1.43
log
@gif_munger taken out of top level Makefile.in 'make all' target.
@
text
@d53 1
a53 1
perl_stub: ptm gui FORCE 
d55 3
@


1.42
log
@changed jpg munger to observe transparency/animation bailout for threshold size based on quality.  fixed gifmunger, but doesnt seem likely we will use it at this point.
@
text
@d17 2
a18 2
all: gui ptm client_lib frontend perl_stub html_munger gif_munger playback\
     tcp_redirect jpg_munger gifjpg_munger tags
@


1.42.4.1
log
@L0 works; sending and registering encrypted URLs works
@
text
@d17 1
a17 1
all: gui ptm client_lib frontend perl_stub html_munger playback\
@


1.42.4.2
log
@Type 1-style rewebber
@
text
@d18 1
a18 1
     tcp_redirect jpg_munger gifjpg_munger crypt_munger tags
a66 3

crypt_munger: ptm gui FORCE
	cd crypt_munger; $(MAKE)
@


1.42.2.1
log
@All up to date now.
@
text
@d35 1
a35 4
	cd tcp_redirect; ./tcp_redirect ../$(OPTIONS) 2> tcp_redirect.errs &

run_tr_check:
	tcp_redirect/src/tr_check.pl $(OPTIONS) 30 &
@


1.41
log
@Added "tcp_redirect" functionality
@
text
@d10 1
d36 4
@


1.40
log
@the perl_stub and perl_dir directories have been added
perl_stub has the source for the c stubs to allow for perl
distillers.

perl_dir is where the distillers live.  It is the location of the PERL_DIR
#define in config_tr.h
@
text
@d17 1
a17 1
     jpg_munger gifjpg_munger tags
d33 3
d54 3
d78 1
@


1.39
log
@works with fe_check.pl
@
text
@d16 1
a16 1
all: gui ptm client_lib frontend html_munger gif_munger playback\
d45 4
a48 1
html_munger: ptm gui
d51 1
a51 1
gif_munger: ptm gui
d54 1
a54 1
jpg_munger: ptm gui
d57 1
a57 1
gifjpg_munger: ptm gui
d74 1
@


1.38
log
@gm_options files changes
@
text
@a12 8
# HACK: temporary options for frontend, until it gets a config file
PORT = 4444
HOSTNAME = $(shell hostname)
ACCEPTPRIO = 30
FE_HOST    = 127.0.0.1
FE_PING_MS = 30000
FE_CMD     = $(MAKE) run_frontend

d27 2
a28 2
run_frontend: proxy_config.pac prefs.html
	cd frontend; ./frontend ../$(OPTIONS) $(ACCEPTPRIO) 2> frontend.errs &
d31 1
a31 8
	cd frontend; src/fe_check.tcl $(FE_HOST) $(PORT) $(FE_PING_MS) "$(FE_CMD)" &

prefs.html: FORCE
	cp frontend/prefs.html .

proxy_config.pac: FORCE
	sed -e 's/%%host:port%%/$(HOSTNAME):$(PORT)/g' frontend/proxy_config.pac > $@@
	chmod 664 $@@
@


1.37
log
@HTML munger changes for the TS logo with frames
fe_checker waits for 30 seconds before re-pinging
@
text
@d10 2
a11 2
MON_OPTIONS  = monitor.options.$(USER)
MONITOR_ADDR = $(shell sed -n 's/monitor.multicast: *//p' ptm/$(OPTIONS))
a15 1
NTHREADS = 350
d19 1
a19 1
FE_CMD     = $(MAKE) run_frontend PORT=$(PORT) NTHREADS=$(NTHREADS)
d30 1
a30 1
	cd gui; ./monitor.tcl $(MON_OPTIONS) -multicast $(MONITOR_ADDR) &
d33 1
a33 1
	cd ptm; ./ptm -o $(OPTIONS) &
d36 1
a36 1
	cd frontend; ./frontend $(PORT) $(NTHREADS) $(MONITOR_ADDR) ../ptm/$(OPTIONS) $(ACCEPTPRIO) 2> frontend.errs &
@


1.36
log
@More bug fixes: using sendmail instead of mail; sending mail if the fe
fails to restart
@
text
@d19 1
a19 1
FE_PING_MS = 2000
@


1.35
log
@Bug fixes
@
text
@d18 3
a20 2
FE_HOST = 127.0.0.1
FE_CMD  = $(MAKE) run_frontend PORT=$(PORT) NTHREADS=$(NTHREADS)
d40 1
a40 1
	cd frontend; src/fe_check.tcl $(FE_HOST) $(PORT) "$(FE_CMD)" &
@


1.34
log
@fe_check: the frontend process-pair
changed Makefile to default NTHREADS to 350
@
text
@d19 1
a19 1
FE_CMD  = make run_frontend PORT=$(PORT) NTHREADS=$(NTHREADS)
@


1.33
log
@added ACCEPTPRIO flag for run_frontend target
@
text
@d16 1
a16 1
NTHREADS = 50
d18 2
d37 3
@


1.32
log
@Added FORCE for playback
@
text
@d17 1
d34 1
a34 1
	cd frontend; ./frontend $(PORT) $(NTHREADS) $(MONITOR_ADDR) ../ptm/$(OPTIONS) 2> frontend.errs &
@


1.31
log
@fixed the prefs.html target
@
text
@d66 1
a66 1
playback: client_lib
@


1.30
log
@Modified the run_monitor entry to accept per-user options filename.
@
text
@d36 1
a36 1
	perl -pe '$$p=1+$(PORT); $$_=~s/%%host:port%%/$(HOSTNAME):$$p/gi' frontend/src/prefs.html > $@@
@


1.29
log
@Added target to Makefile.in to do make clean on giftojpg_munger.
@
text
@d10 1
d27 1
a27 1
	cd gui; ./monitor.tcl -multicast $(MONITOR_ADDR) &
@


1.28
log
@Monitor local kill still doesn't work.  Frontend user prefs parsing
works for simple form submission; the form is in tcsproxy/prefs.html,
and is generated automatically when run_frontend is done. the user prefs
port is 1+the proxy main port.
@
text
@d79 1
@


1.27
log
@/bin/sh doesnt understand "unlimit descriptors"
@
text
@d31 1
a31 1
run_frontend: proxy_config.pac
d33 3
@


1.26
log
@Make targets now work in the right order, really!
@
text
@d32 1
a32 1
	unlimit descriptors; cd frontend; ./frontend $(PORT) $(NTHREADS) $(MONITOR_ADDR) ../ptm/$(OPTIONS) 2> frontend.errs &
@


1.25
log
@client_lib does not depend on cached - took out dependency.
@
text
@d17 3
d21 1
a21 1
     jpg_munger gifjpg_munger cached-1.4.pl3 tags
d41 1
a41 1
client_lib:
@


1.24
log
@added unlimit descriptors to frontend run target
@
text
@d38 1
a38 1
client_lib: cached-1.4.pl3
@


1.23
log
@toplevel makefile targets now reflect true interunit dependencies
@
text
@d29 1
a29 1
	cd frontend; ./frontend $(PORT) $(NTHREADS) $(MONITOR_ADDR) ../ptm/$(OPTIONS) 2> frontend.errs &
@


1.22
log
@all "run" targets now put their programs in the background.
run_frontend redirects stderr to "frontend.errs", but ideally we
shouldn't have to rely on fprintf(stderr) at all.
html and gif distillers no longer spew debugging output to stderr.
Monitor now prints to stderr if the monitor object has the sentinel
value MON_USE_STDERR.
in doc directory, distillers.txt is now distillers.pod.  Use pod2* to
make it into HTML,LaTEX, etc.
@
text
@d38 1
a38 1
client_lib: FORCE
d41 1
a41 1
frontend: FORCE
d47 1
a47 1
html_munger: FORCE
d50 1
a50 1
gif_munger: FORCE
d53 1
a53 1
jpg_munger: FORCE
d56 1
a56 1
gifjpg_munger: FORCE
d59 1
a59 1
playback: FORCE
@


1.21
log
@added thread-monitoring stuff to frontend, fixed thread-monitoring procs in GUI, added proxy autoconfig file target to toplevel Makefile
@
text
@d29 1
a29 1
	cd frontend; ./frontend $(PORT) $(NTHREADS) $(MONITOR_ADDR) ../ptm/$(OPTIONS)
d78 1
a78 1
	find . -name \*.c -print -o -name \*.cc -print -o -name \*.h -print | etags -
@


1.20
log
@Added stuff for giftojpg_munging..
@
text
@d14 1
d28 1
a28 1
run_frontend:
d30 4
@


1.19
log
@changed order of "all" target
@
text
@d17 1
a17 1
     jpg_munger cached-1.4.pl3 tags
d50 3
@


1.18
log
@fixes to client_lib to compile correctly with new libmon.h
@
text
@d16 1
a16 1
all: ptm client_lib frontend gui html_munger gif_munger playback\
@


1.17
log
@Put minus in front of cached compile.
@
text
@d70 1
a70 1
	find . -name \*.c -print -o -name \*.cc -print -o -name \*.h -print | xargs etags
@


1.16
log
@new command line format for running frontend
@
text
@d55 1
a55 1
	cd cached-1.4.pl3; $(MAKE)
@


1.15
log
@Fixed Makefile.in toplevel.
@
text
@d28 1
a28 1
	cd frontend; ./frontend $(PORT) $(NTHREADS) ../ptm/$(OPTIONS)
@


1.14
log
@Added skeleton for the jpeg munger, in jpg_munger.  Fixed up top-level
Makefile.in to include it, and fixed up configure.in to deal with
the needed libjpeg.a library.
@
text
@d64 1
a64 1
        cd jpg_munger; $(MAKE) clean
@


1.13
log
@Fixed tags target in Makefile.in to also look at .cc files
@
text
@d17 1
a17 1
     cached-1.4.pl3 tags
d48 3
d64 1
@


1.12
log
@Added tags target to toplevel Makefile.in
@
text
@d66 1
a66 1
	find . -name \*.c -print -o -name \*.h -print | xargs etags
@


1.11
log
@Added doc/distillers.txt, which explains how to write your own
distiller.  Gifmunger should now do the right thing even on extremely
large images.  Default args for gifmunger are more sane (16 colors,
scale 0.5 per axis), but output still looks sucky - not sure why the
quantize phase picks such crappy colors.  "test_http" program has been
officially renamed "frontend".  Fixed the "run" targets in toplevel
Makefile.  Added line to configure.in to create a Makefile from
Makefile.in for gui.
@
text
@d17 1
a17 1
     cached-1.4.pl3
d64 3
@


1.10
log
@frontend/part.config: points to single u49 harvest partition
Makefile.in: contains the per-person targets for run_*.
ptm/distillers.db.sample: distiller binaries are at ../ rather than
absolute pathname
also added distillers.db.fox, gm_options.fox for PTM
@
text
@d10 1
a10 1
MONITOR_ADDR = $(shell sed -n 's/monitor.multicast: +//p' ptm/$(OPTIONS))
d28 1
a28 1
	cd frontend; ./test_http $(PORT) $(NTHREADS) ../ptm/$(OPTIONS)
@


1.9
log
@Various changes and 'fixes' but they are not stable yet.  the 'heisenbug' contour seems more stable; should debug from that contour, then merge diffs with head (i.e. this) contour.
@
text
@d8 7
a14 5
MONITOR_ADDR = 228.8.8.8
MONITOR_PORT = 8888
PTM_ADDR     = 224.9.9.9
PTM_PORT     = 9999
PTM_OPTIONS  = .gm_options.sample
d22 1
a22 1
	cd gui; ./monitor.tcl -multicast $(MONITOR_ADDR)/$(MONITOR_PORT) &
d25 1
a25 2
	#	cd ptm; ./ptm -m $(PTM_ADDR)/$(PTM_PORT)/1 -l $(MONITOR_ADDR)/$(MONITOR_PORT) -o $(PTM_OPTIONS) &
	cd ptm; ./ptm -o $(PTM_OPTIONS) &
d28 1
a28 1
	cd frontend; ./frontend -port 5678
d63 1
@


1.8
log
@*** empty log message ***
@
text
@d23 2
a24 1
	cd ptm; ./ptm -m $(PTM_ADDR)/$(PTM_PORT)/1 -l $(MONITOR_ADDR)/$(MONITOR_PORT) -o $(PTM_OPTIONS) &
@


1.7
log
@Changed "int" argument type to be signed rather than unsigned.  Required
addition of INT32 type to config.h.in, and addition of overload
operators '<<', '>>' for type "long int" to IStream and OStream classes
in ptm (mods to packet.{cc,h}).  Added various "make run" targets at top
level.  Minor fixes to monitor's GUI.  Added simple argument parsing to
gif_munge in ARGS.h, which will be the standard filename where distiller
args are defined.  Added tags target to ptm makefile.
@
text
@d12 1
d23 1
a23 1
	cd ptm; ./ptm -m $(PTM_ADDR)/$(PTM_PORT)/1 -l $(MONITOR_ADDR)/$(MONITOR_PORT) &
@


1.6
log
@Tweaks
@
text
@d8 5
d15 11
@


1.5
log
@Top level makefile now works.
@
text
@d8 2
a9 8
all: Makefile ptm client_lib frontend gui html_munger gif_munger playback\
     # cached-1.4.pl3

Makefile: configure
	./configure

configure: configure.in
	/bin/rm -f config.cache; autoconf
d33 1
a33 1
	cd cached-1.4.pl3; $(MAKE); $(MAKE) install
@


1.4
log
@*** empty log message ***
@
text
@d6 46
@


1.3
log
@I haven't the foggiest.
@
text
@d5 2
@


1.2
log
@cleaned up and added some stuff to autoconf files
@
text
@d4 1
a4 1

@


1.1
log
@Makefile.in for autoconf
@
text
@d2 1
a2 1
CFLAGS = @@CFLAGS@@
@
